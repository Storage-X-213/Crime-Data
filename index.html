<!DOCTYPE html>
<html>
<head>
	<!-- Code for the set up of the Mapbox API -->
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<script src='https://api.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.js'></script>
	<link href='https://api.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.css' rel='stylesheet' />
	<script src="jquery-3.4.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="styleSheet.css"/>
	<!--<link rel="stylesheet" type="text/css" href="styleSheetOld.css"/>-->
    <script src="jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="jquery-ui.css">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta charset="UTF-8">
</head>	

<body>


	<label for="month">Month: </label>
	<input type="text" id="month" name="month" class="monthPicker" />
	<div class="dropdown">
		<button onclick="myFunction()" class="dropbtn">Constabulary</button>
		<div id="myDropdown" class="dropdown-content">
			<a value="2014">2014</a>
			<a value="2013">2013</a>
			<a value="2012">2012</a>
		</div>
	</div>
	<div id='map'></div>
	<!--<div id='ui-datepicker-div'></div>-->
	<script>
	function myFunction() {
		document.getElementById("myDropdown").classList.toggle("show");
	}
	window.onclick = function(event) {
		if (!event.target.matches('.dropbtn')) {
			var dropdowns = document.getElementsByClassName("dropdown-content");
			var i;
			for (i = 0; i < dropdowns.length; i++) {
				var openDropdown = dropdowns[i];
				if (openDropdown.classList.contains('show')) {
					openDropdown.classList.remove('show');
				}
			}
		}
	}
	var month = "";
	var year = "";
	var dataUrl="https://raw.githubusercontent.com/Storage-X-213/Storage-X-213.github.io/master/2016-07/2016-07-suffolk-street.geojson"
	/*Code for the set up of the Mapbox API */
	mapboxgl.accessToken = "pk.eyJ1IjoibGVzcCIsImEiOiJjazA4NDNha3kwMWphM29wY2RkbnluZHJzIn0.dFz1M9lx7My6TbmDBJy6qA";
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/streets-v11',	
		center: [1.1482,52.0567],
		minZoom: 10,
		zoom: 13,
		dragRotate: false,
		
	
	});
	/*Code for the setup of the "month picker"*/
	$(document).ready(function()
	{  
		
	

		$(".monthPicker").datepicker({
			
			maxDate: "0",
			minDate: new Date(2016, 6, 1),
			changeMonth: true,	
			changeYear: true,
			showButtonPanel: true,

			onClose: function(dateText, inst) {
				month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
				year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
				$(this).val($.datepicker.formatDate('MM yy', new Date(year, month, 1)));

				var monthInt=parseInt(month,10);
			}

		});

		$(".monthPicker").focus(function () {
			$(".ui-datepicker-calendar").hide();
			$("#ui-datepicker-div").position({
				my: "center top",
				at: "center bottom",
				of: $(this)
			});
		});
	});
	
	
	map.on('style.load', function() {
		map.addSource("crimeData", {
			type: "geojson",
			data: dataUrl,
			cluster: true,
			clusterMaxZoom: 14, // Max zoom to cluster points on
			clusterRadius: 50 // Radius of each cluster when clustering points (defaults to 50)
			
		});
		map.addLayer({
			"id": "crimePoints",
			"type": "circle",
			"source": "crimeData",
			'paint': {
				//   * Green, 20px circles when point count is less than 50
				//   * Yellow, 30px circles when point count is between 50 and 300
				//   * Red, 40px circles when point count is between 300 and 1000
				//   * Dark Red, 50px circles when point count above 1000
				"circle-color": [
				"step",
				["get", "point_count"],
					"#38FE0D",
					50,
					"#FFFC32",
					300,
					"#FF0000",
					1000,
					"#C40000"
				],
				"circle-radius": [
					"step",
					["get", "point_count"],
						20,
						50,
						30,
						300,
						40,
						1000,
						50
					]
				}
			});
		
		map.addLayer({
			id: "cluster-count",
			type: "symbol",
			source: "crimeData",
			filter: ["has", "point_count"],
			layout: {
			"text-field": "{point_count_abbreviated}",
			"text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
			"text-size": 12
			}
		});
	});
		
		function init(){
            map.addSource('crimeData', {
            type: 'geojson',
            data: dataUrl,
			});
			map.addLayer({            
			'id': 'crimePoints',
            'type': 'circle',
            'source': 'crimeData',});
		};
		
	</script>
	
</body>
</html>
